---
title: "Wild Yeast Report DRAFT"
date: "`r format(Sys.Date())`"
author:
- Douglas Campbell^1^*
- Carlie Barnhill^1^*
- Jacob MacPhee^1^*
- Kenneth McLaughlin^1^*

output:
  bookdown::html_document2:
    code_folding: show
    keep_md: yes
    toc: TRUE
    toc_float: TRUE
    toc_depth: 6
    fig_caption: yes
editor_options: 
  markdown: 
    wrap: 72
---
```{css, echo=FALSE}
p.caption {
  font-size: 18px;
}
```


# Affiliations {-}
^1^Mount Allison University, New Brunswick, Canada  

*corresponding author  

# Acknowledgements {-}
Brackets minus after heading excludes heading from numbering.
DAC was supported by the Canada Research Chairs.

# Overview
File import functions read files into R objects, commonly data frames. 

# Materials & Methods  
## Set chunk options
Formatted display of content from .md file on GitHub site.
Upon knitr figures will be saved to 'Figs/'
```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, error = FALSE, message = FALSE)
knitr::opts_chunk$set(fig.path='Figs/')
```

## Load packages
```{r packages, include = FALSE}
# Install the googlesheets4 package if not already installed
# install.packages("googlesheets4")
library(tidyverse) #core packages from Tidyverse
library(googledrive) #access to GoogleDrive
library(googlesheets4) #access to GoogleSheets
```

## InLine Citations of software packages added through the 'citr' option under 'Addins'.  
The cited items must be in the .bib file saved in the .Rproj folder; in this case RPackageCitations.bib, generated by exporting a library to .bib from Zotero.  Upon export click the 'Keep Updated' button in the BetterBibTex menu.  If new citations are added to Zotero they will be pushed through to update the exported .bib file in the .Rproj folder.
[@bryanGooglesheets4AccessGoogle2021;@mcgowanGoogledriveInterfaceGoogle2020; @wickhamTidyverseEasilyInstall2017]

# Import MetaData from a GoogleSheet
MetaData in a GoogleSheet is more generic than a project-specific .csv edited and saved locally.
The GoogleSheet interface can be tricky.
Repeatedly reading from GoogleDrive can provoke a throttle from Google.

```{r Retrieve ATMetaData}
# Authenticate with Google Sheets (you only need to do this once)
# gs4_auth()


#Instead of sending a token, googlesheets4 will send an API key. This can be used to access public resources for which no Google sign-in is required. 
googlesheets4::gs4_deauth()

# Define the Google Sheet URL (replace with your actual URL)
sheet_url <- "https://docs.google.com/spreadsheets/d/17dDzASxhWDbVpQFXb201vT2oB0rkyi2h4gG33ArOaDA/edit?usp=sharing"

# Read the Google Sheet into R as a data frame
ATMetaData <- read_sheet(sheet_url)

# View the imported data (optional)
View(ATMetaData)
```

```{r Retrieve SpecificGravityMetaData}
# Authenticate with Google Sheets (you only need to do this once)
# gs4_auth()

#Instead of sending a token, googlesheets4 will send an API key. This can be used to access public resources for which no Google sign-in is required. 
googlesheets4::gs4_deauth()

# Define the Google Sheet URL (replace with your actual URL)
sheet_url <- "https://docs.google.com/spreadsheets/d/15Qd3DYkeRX4FCy84Uw9ns9L6Bq6P959csP-opdGvBME/edit?usp=sharing"

# Read the Google Sheet into R as a data frame
SpecificGravityMetaData <- read_sheet(sheet_url)

# View the imported data (optional)
View(SpecificGravityMetaData)
```

```{r Retrieve BrothPlateMetaData}
# Authenticate with Google Sheets (you only need to do this once)
# gs4_auth()

#Instead of sending a token, googlesheets4 will send an API key. This can be used to access public resources for which no Google sign-in is required. 
googlesheets4::gs4_deauth()

# Define the Google Sheet URL (replace with your actual URL)
sheet_url <- "https://docs.google.com/spreadsheets/d/118YF2qZqtC5yCfqyDeRaGQhgm5v8mn6wC_6ae1Rnyik/edit?usp=sharing"

# Read the Google Sheet into R as a data frame
BrothPlateMetaData <- read_sheet(sheet_url)

# View the imported data (optional)
View(BrothPlateMetaData)
```

```{r Retrieve VitalityFermentationMetaData}
# Authenticate with Google Sheets (you only need to do this once)
gs4_auth()

# Define the Google Sheet URL (replace with your actual URL)
sheet_url <- "https://docs.google.com/spreadsheets/d/1mKZNT4blSBhuVf4K8_ddhGqOaep2aScUVqMXixWkkwI/edit?usp=sharing"

# Read the Google Sheet into R as a data frame
VitalityFermentationMetaData <- read_sheet(sheet_url)

# View the imported data (optional)
View(VitalityFermentationMetaData)
```

```{r Retrieve NotesMetaData}
# Authenticate with Google Sheets (you only need to do this once)
gs4_auth()

# Define the Google Sheet URL (replace with your actual URL)
sheet_url <- "https://docs.google.com/spreadsheets/d/1phYyUXKip9W4sfQH6zrZxw49RH5AH72zuFHsqgvMoTQ/edit?usp=sharing"

# Read the Google Sheet into R as a data frame
NotesMetaData <- read_sheet(sheet_url)

# View the imported data (optional)
View(NotesMetaData)
```

```{r Retrieve DataDictionary}
# Authenticate with Google Sheets (you only need to do this once)
gs4_auth()

# Define the Google Sheet URL (replace with your actual URL)
sheet_url <- "https://docs.google.com/spreadsheets/d/1YN_s-YRdM4j9t_c_l1Z4-Q53KQlURTlDpItovzZNd3g/edit?usp=sharing"

# Read the Google Sheet into R as a data frame
DataDictionary <- read_sheet(sheet_url)

# View the imported data (optional)
View(DataDictionary)
```

```{r percent of living yeast compared to total yeast from each sample ID containing yeast graphing on bar graph}
ggplot(VitalityFermentationMetaData, aes(x = as.factor(Sample_ID), y = Viability_Percent, fill = as.factor(Sample_ID))) +
  geom_bar(stat = "identity", alpha = 0.7) +  # Bars for Sample_ID
  geom_text(aes(label = round(Viability_Percent, 1)), 
            vjust = -0.5, hjust = 0.5, size = 4, color = "black") +  # Add centered data labels
  theme_minimal() +
  labs(title = "Viability Percent by Sample ID", x = "Sample ID", y = "Viability Percent") + theme( axis.text.x = element_text(angle = 0, hjust = 0.5),  # Center x-axis labels
legend.position = "none") + scale_fill_manual (values = c( "7" = "orange", "18" = "blue", "19" = "green", "36" = "red", "41" = "purple", "43" = "black"))
```

```{r merged data metadata}
VitalityFermentationMetaData_2 <- left_join(VitalityFermentationMetaData, BrothPlateMetaData, by = "Sample_ID")
```

```{r percent of living yeast compared to total yeast from each sample ID containing yeast graphing on bar graph}
VitalityFermentationMetaData_2 |>
filter(!is.na(Sample_ID)) |>
ggplot( aes(x = as.factor(Sample_ID), y = Viability_Percent, fill = as.factor(Broth_Source))) +
  geom_point() + 
  #geom_col() +  # Bars for Sample_ID
  geom_text(aes(label = round(Viability_Percent, 1)), 
            vjust = -0.5, hjust = 0.5, size = 4, color = "black") +  # Add centered data labels
  facet_grid(cols = vars(Broth_Source))
 #theme_minimal() +
 # labs(title = "Viability Percent by Sample ID", x = "Sample ID", y = "Viability Percent") +
#theme( axis.text.x = element_text(angle = 0, hjust = 0.5),  # Center x-axis labels
#legend.position = "none") + 
  #scale_fill_manual (values = c( "7" = "orange", "18" = "blue", "19" = "green", "36" = "red", "41" = "purple", "43" = "black"))
```

```{r final acohol percent of each sample }
# Extract SG at Time = 0
initial_sg_values <- SpecificGravityMetaData %>%
  filter(Time == 0) %>%
  select(Sample_ID, Specific_Gravity) %>%
  rename(Initial_SG = Specific_Gravity)

# Extract Final SG the minimum SG for each Sample_ID
final_sg_values <- SpecificGravityMetaData %>%
  group_by(Sample_ID) %>%
  summarize(Final_SG = min(Specific_Gravity, na.rm = TRUE), .groups = "drop")

# Merge Initial SG and Final SG
combined_sg_values <- merge(initial_sg_values, final_sg_values, by = "Sample_ID")

# Calculate ABV (Alcohol By Volume) getting the percent of alcohol in the final beer
combined_sg_values <- combined_sg_values %>%
  mutate(ABV = (Initial_SG - Final_SG) * 131.25)

# making a table of final results
print(combined_sg_values)
```

```{r the SG of each sample ID versus time collected throught the brewing proccess}
# making sure the data is formatted good
SpecificGravityMetaData$Sample_ID <- as.factor(SpecificGravityMetaData$Sample_ID)
SpecificGravityMetaData$Time <- as.numeric(SpecificGravityMetaData$Time)

# making the graph
library(ggplot2)
ggplot(SpecificGravityMetaData, aes(x = Time, y = Specific_Gravity, color = Sample_ID, group = Sample_ID)) + geom_line(size = 1) + geom_point(size = 2) + labs( title = "Specific Gravity Over Time by Yeast Strain", x = "Time (hours)", y = "Specific Gravity", color = "Sample ID") +

theme_minimal() + scale_color_manual(values = c("7" = "orange", "18" = "blue", "19" = "green", "36" = "red", "41" = "purple", "43" = "black"))
```

```{r the following code is for the rate of fermentation versus time for each sample type-- this shows if the rate of alcohol production changes as the brewing time increases}
library(dplyr)
library(ggplot2)

# finding the rate of change for Specific Gravity vs. Time
SpecificGravityMetaData <- SpecificGravityMetaData %>%
  group_by(Sample_ID) %>%
  mutate(SG_Rate = c(NA, diff(Specific_Gravity) / diff(Time)))

# ploting
ggplot(SpecificGravityMetaData, aes(x = Time, y = SG_Rate, color = as.factor(Sample_ID))) + geom_line(size = 1) + geom_point(size = 2) + labs(title = "Fermentation Rate versus Time of each Sample ID", x = "Time (hours)", y = "SG Rate (SG/hour)", color = "Sample ID") + facet_wrap(~ Sample_ID, scales = "free_y") +  
  theme_minimal() +
  theme(legend.position = "none") +  
  scale_color_manual(values = c( "7" = "orange", "18" = "blue", "19" = "green", "36" = "red", "41" = "purple", "43" = "black"))
```

```{r making a graph to show how long each brew took to reach the final SG }
library(dplyr)
library(ggplot2)

# calculating the Final SG and the time taken to reach it for each Sample_ID
completion_times <- SpecificGravityMetaData %>%
  group_by(Sample_ID) %>%
  filter(Specific_Gravity == min(Specific_Gravity, na.rm = TRUE)) %>%
  summarize(Completion_Time = min(Time), .groups = "drop")  # telling it to use earliest collection time if multiple exist

# making the graph
ggplot(completion_times, aes(x = factor(Sample_ID), y = Completion_Time, fill = as.factor(Sample_ID))) +
  geom_bar(stat = "identity") + labs(title = "Time Taken to Reach the Final Specific Gravity", x = "Sample ID", y = "Completion Time (hours)") +
  theme_minimal() + scale_fill_manual(values = c("7" = "orange", "18" = "blue", "19" = "green", "36" = "red", "41" = "purple", "43" = "black"))
```

```{r finding out the atenuation of the sample this will identify the efficency of the yeast strain by comparing the sugar content in the initial wart to the amount of sugars left over giving a percent of sugars consumed and converted to alcohol or CO2}
library(dplyr)
library(ggplot2)

# Attenuation for Each Sample
attenuation_data <- SpecificGravityMetaData %>%
  group_by(Sample_ID) %>%
  summarize(
    Initial_SG = max(Specific_Gravity, na.rm = TRUE),  # initial SG is the max
    Final_SG = min(Specific_Gravity, na.rm = TRUE),    # Final SG is the min
    .groups = "drop"
  ) %>%
  mutate(
    Apparent_Attenuation = ((Initial_SG - Final_SG) / (Initial_SG - 1)) * 100
  )

# graphing
ggplot(attenuation_data, aes(x = factor(Sample_ID), y = Apparent_Attenuation, fill = as.factor(Sample_ID))) + geom_bar(stat = "identity") + labs( title = "Apparent Attenuation by Sample ID", x = "Sample ID", y = "Apparent Attenuation (%)") +
  theme_minimal() +
  scale_fill_manual( values = c( "7" = "orange", "18" = "blue", "19" = "green", "36" = "red", "41" = "purple", "43" = "black"))
```

\newpage

# Bibliography
